<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    
    
    <link rel="manifest" href="manifest.json">
    
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
</head>
<body>
    
    <h1>HelloðŸ‘‹</h1>
    <h2>Thanks for using N2K.</h2>
    
    <!-- Add a simpler button:
        Simple button that will open the modal.
    -->
    <!-- <button onclick="openNetlifyWidget()" id="loginbutton">Login</button> -->

    <button id="login-form" onclick="openNetlifyWidget()">Login with Netlify Identity</button>

    <pre id="version">v1.1</pre>
    <h2>Log : </h2>
    <pre id="log"></pre>
    
    
    <script>

        function openNetlifyWidget() {
            netlifyIdentity.open();
        }

        const user = netlifyIdentity.currentUser();
        console.log('current user :', user)

        netlifyIdentity.on('init', user => {
            console.log('init. User :', user)
            //User is not logged in
            if (user == null) {
                document.getElementById('login-form').style.display = 'block';
            }else {
                console.log('Welcome back, '+user);
            }
        });

        netlifyIdentity.on('login', user => {
            console.log('Login succesfull for', user);
        });
        
        
        
        var parsedUrl = new URL(window.location.toString());
        console.log('Title shared: ' + parsedUrl.searchParams.get('title'));
        console.log('Text shared: ' + parsedUrl.searchParams.get('text'));
        document.getElementById("log").innerHTML += parsedUrl.searchParams.get('title')+ "\n";
        document.getElementById("log").innerHTML += parsedUrl.searchParams.get('text');
        
        var apiAWS = "https://bhn3zq0bak.execute-api.us-east-1.amazonaws.com/dev/sendtokindle?q="
        let linkArticle = parsedUrl.searchParams.get('text');
        var xmlHttp = new XMLHttpRequest();
        
        
        xmlHttp.open("GET", apiAWS+linkArticle)
        console.log("request to "+apiAWS+linkArticle)
        if (linkArticle != null) {
            xmlHttp.send();
        }
        console.log("Response :", xmlHttp.response)
        
        
        
        
        
    </script>
    
    <script>
        console.log("Hello world !")
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
        }
        
    </script>
</body>
</html>